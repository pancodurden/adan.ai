<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>adan.ai — Local</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  /* =========================================
     SAKURA MIST — Ultra Liquid Glass + Center
     (Script'e dokunmadan sadece stil/yerleşim)
     ========================================= */

  /* Kutu modeli ve temel reset */
  *,*::before,*::after{ box-sizing:border-box }
  html,body{ height:100%; margin:0 }

  :root{
    /* Tema: Sakura pastel + cam */
    --pink:#f8a8b5;
    --orange:#f7bd86;
    --ink:#1f130f;              /* cam üstü yazılar için koyu */
    --ink-contrast:#2b1a14;

    --bg1:#fff6fa;              /* arka plan degrade tonları */
    --bg2:#ffeede;
    --bg3:#fffafd;

    /* Cam katmanları (daha şeffaf) */
    --glass-1: rgba(255,255,255,0.12); /* dış katman */
    --glass-2: rgba(255,255,255,0.20); /* iç highlight */
    --glass-3: rgba(255,255,255,0.08); /* alt soft */

    --edge: rgba(255,255,255,0.35);
    --edge-sub: rgba(255,255,255,0.20);

    --radius-lg: 28px;
    --radius-md: 18px;

    --blur-strong: 28px;        /* aşırı liquid glass için kuvvetli blur */
    --blur-card: 22px;
    --blur-ui: 16px;

    --ring: 0 0 0 3px rgba(248,168,181,0.55), 0 0 0 8px rgba(247,189,134,0.20);

    --shadow-lg: 0 40px 120px rgba(248,168,181,0.22), 0 24px 60px rgba(247,189,134,0.18);
    --shadow-md: 0 24px 70px rgba(248,168,181,0.18), 0 16px 40px rgba(247,189,134,0.14);
    --shadow-inset: inset 0 1px 0 rgba(255,255,255,0.45);
  }

  /* Arka plan: pastel + dalgalanan cam animasyonları */
  body{
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--ink);
    background:
      radial-gradient(1200px 800px at 18% -8%, rgba(255,210,224,0.45), transparent 60%),
      radial-gradient(1200px 800px at 82% 108%, rgba(255,224,200,0.45), transparent 60%),
      linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 45%, var(--bg3) 100%);
    background-attachment: fixed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;

    /* Ortalama: tam ekran ortala */
    min-height: 100dvh;
    display: grid;
    place-items: center;
    position: relative;
    overflow-x: hidden;
  }

  /* Dalgalanan cam katmanları (ultra smooth) */
  body::before,
  body::after{
    content:"";
    position: fixed; inset:-25vmax;
    z-index:-2; pointer-events:none;
    filter: blur(70px) saturate(1.08);
    opacity:.55;
  }
  body::before{
    background:
      conic-gradient(from 0deg at 50% 50%,
        rgba(248,168,181,0.18),
        rgba(247,189,134,0.18),
        rgba(248,168,181,0.18),
        rgba(247,189,134,0.18),
        rgba(248,168,181,0.18));
    animation: swirl 30s linear infinite;
  }
  body::after{
    background:
      radial-gradient(40vmax 40vmax at 20% 30%, rgba(255,255,255,0.18), transparent 60%),
      radial-gradient(46vmax 46vmax at 80% 70%, rgba(255,255,255,0.14), transparent 60%);
    animation: drift 34s ease-in-out infinite alternate;
  }
  @keyframes swirl { to{ transform: rotate(360deg) } }
  @keyframes drift {
    0%   { transform: translate3d(-3%,-2%,0) scale(1.02) }
    100% { transform: translate3d( 3%, 2%,0) scale(1.06) }
  }

  /* Hafif noise, cam dokusu */
  .noise{
    position: fixed; inset:0; z-index:-1; pointer-events:none;
    background-image:
      radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.06) 0, rgba(255,255,255,0) 100%),
      radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,0.05) 0, rgba(255,255,255,0) 100%);
    background-size: 320px 320px, 280px 280px;
    opacity:.5; mix-blend-mode: soft-light;
  }

  /* Sol üstte animasyonlu marka: adan.ai */
  .brand{
    position: fixed; top:18px; left:18px; z-index:10;
    padding:10px 14px;
    color:#2b1a14;
    font-weight:800; letter-spacing:.5px;
    text-transform: lowercase;
    border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.24), rgba(255,255,255,0.10));
    border:1px solid rgba(255,255,255,0.55);
    backdrop-filter: blur(var(--blur-ui)) saturate(1.1);
    -webkit-backdrop-filter: blur(var(--blur-ui)) saturate(1.1);
    box-shadow: var(--shadow-inset), 0 16px 40px rgba(248,168,181,0.18);
    overflow:hidden;
  }
  .brand::before{
    /* Sürekli kayan highlight */
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,0.65) 35%, transparent 70%);
    transform: translateX(-120%);
    animation: shine 4.8s ease-in-out infinite;
    pointer-events:none;
    mix-blend-mode: screen;
  }
  .brand::after{
    /* Minik yüzen cam damlası */
    content:"";
    position:absolute; width:14px; height:14px; right:8px; bottom:8px;
    border-radius:999px;
    background: radial-gradient(circle, rgba(255,255,255,0.9), rgba(255,255,255,0.2) 65%, transparent 70%);
    filter: blur(0.4px);
    animation: float 3.8s ease-in-out infinite alternate;
  }
  @keyframes shine { 0%{transform:translateX(-120%)} 50%{transform:translateX(60%)} 100%{transform:translateX(120%)} }
  @keyframes float { 0%{ transform: translateY(0) } 100%{ transform: translateY(-3px) } }

  /* Ana panel (shell) — çok katmanlı liquid glass */
  .shell{
    width: min(1040px, 92vw);
    /* Yüksekliği içeriğe göre; ortalama body grid ile */
    padding: 24px;
    border-radius: var(--radius-lg);
    border:1px solid var(--edge);
    background:
      radial-gradient(120% 120% at 10% -10%, rgba(255,255,255,0.28), rgba(255,255,255,0.06) 60%),
      linear-gradient(180deg, var(--glass-2), var(--glass-3));
    backdrop-filter: blur(var(--blur-strong)) saturate(1.18);
    -webkit-backdrop-filter: blur(var(--blur-strong)) saturate(1.18);
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }
  /* İç parlama + alt vinyet, cam derinliği */
  .shell::before{
    content:"";
    position:absolute; inset:-2px -2px auto -2px; height:70px;
    background: linear-gradient(180deg, rgba(255,255,255,0.70), rgba(255,255,255,0));
    filter: blur(8px); opacity:.5; pointer-events:none;
  }
  .shell::after{
    content:"";
    position:absolute; inset:auto -2px -2px -2px; height:60px;
    background: linear-gradient(0deg, rgba(255,255,255,0.12), rgba(255,255,255,0));
    filter: blur(12px); opacity:.6; pointer-events:none;
  }

  /* Başlık kaldırıldı. Sub-info satırı estetik kalsın (opsiyonel) */
  .sub{ margin: 0 0 8px; text-align:center; opacity:.85; font-size:12px; color:#2b1a14 }

  /* Grid */
  .grid{ display:grid; grid-template-columns:1.2fr .8fr; gap:16px; align-items:start }
  @media (max-width:980px){ .grid{ grid-template-columns:1fr } }

  /* Kartlar: ultra şeffaf cam */
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.16), rgba(255,255,255,0.08));
    border:1px solid var(--edge);
    border-radius: var(--radius-md);
    padding:12px;
    backdrop-filter: blur(var(--blur-card)) saturate(1.08);
    -webkit-backdrop-filter: blur(var(--blur-card)) saturate(1.08);
    box-shadow: var(--shadow-inset), var(--shadow-md);
  }

  /* Chat log */
  #log{
    height:420px; overflow:auto; padding:12px; border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
    border:1px solid var(--edge-sub);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.22);
    -webkit-mask-image: linear-gradient(transparent 0, black 16px, black calc(100% - 16px), transparent 100%);
            mask-image: linear-gradient(transparent 0, black 16px, black calc(100% - 16px), transparent 100%);
  }
  #log::-webkit-scrollbar{ width:10px }
  #log::-webkit-scrollbar-thumb{
    background: linear-gradient(180deg, rgba(255,255,255,0.45), rgba(255,255,255,0.18));
    border-radius:999px; border:2px solid transparent; background-clip: padding-box;
  }

  /* Mesaj balonları */
  .msg{
    margin:8px 0; padding:10px 14px; border-radius:16px; max-width:85%;
    overflow-wrap:anywhere; border:1px solid rgba(255,255,255,0.38);
    backdrop-filter: blur(12px) saturate(1.15);
    -webkit-backdrop-filter: blur(12px) saturate(1.15);
    box-shadow: 0 10px 28px rgba(248,168,181,0.14);
    color: var(--ink-contrast);
  }
  .you{ margin-left:auto; background: linear-gradient(135deg, rgba(248,168,181,0.52), rgba(247,189,134,0.42)) }
  .bot{ margin-right:auto; background: linear-gradient(135deg, rgba(247,189,134,0.56), rgba(255,231,210,0.42)) }

  .row{ display:flex; gap:8px; margin-top:10px; align-items:center }

  /* Formlar */
  input,button,textarea{
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.55);
    outline:none;
    background:
      radial-gradient(160% 120% at 50% -20%, rgba(255,255,255,0.32), rgba(255,255,255,0.10) 60%),
      linear-gradient(180deg, rgba(255,255,255,0.24), rgba(255,255,255,0.12));
    color: var(--ink-contrast);
    padding:12px 14px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.75), 0 14px 36px rgba(248,168,181,0.12);
    backdrop-filter: blur(var(--blur-ui)) saturate(1.05);
    -webkit-backdrop-filter: blur(var(--blur-ui)) saturate(1.05);
    transition: box-shadow .25s ease, transform .15s ease, border-color .25s ease, background .25s ease;
    min-width:0;
  }
  input{ flex:1 }
  textarea{ width:100%; min-height:160px; resize:vertical }

  input:hover, textarea:hover{
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.85), 0 16px 40px rgba(247,189,134,0.16);
  }
  input:focus-visible, textarea:focus-visible{
    box-shadow: var(--ring);
    border-color:#fff;
  }

  /* Liquid glass buton + ripple */
  button{
    cursor:pointer; font-weight:800; letter-spacing:.2px;
    color:#2b1a14; position:relative; overflow:hidden;
    background:
      radial-gradient(160% 120% at 50% -20%, rgba(255,255,255,0.48), rgba(255,255,255,0.10) 60%),
      linear-gradient(135deg, rgba(248,168,181,0.88), rgba(247,189,134,0.88));
    border:1px solid rgba(255,255,255,0.65);
    transform: translateZ(0);
  }
  button::before{
    content:""; position:absolute; inset:0;
    background: linear-gradient(180deg, rgba(255,255,255,0.35), rgba(255,255,255,0));
    pointer-events:none; mix-blend-mode:screen; opacity:.75;
  }
  button:hover{
    transform: translateY(-1px);
    box-shadow: 0 12px 34px rgba(248,168,181,0.28), 0 0 0 1px rgba(255,255,255,0.55) inset;
    border-color:#fff;
  }
  button:active{
    transform: translateY(0) scale(0.985);
    box-shadow: 0 8px 22px rgba(247,189,134,0.26), 0 0 0 2px rgba(255,255,255,0.55) inset;
  }
  button::after{
    content:"";
    position:absolute; left:50%; top:50%;
    width:12px; height:12px; border-radius:999px;
    background: radial-gradient(circle, rgba(255,255,255,0.85), rgba(255,255,255,0) 60%);
    transform: translate(-50%,-50%) scale(0.15);
    opacity:0; pointer-events:none;
  }
  button:active::after{ animation: ripple .65s ease-out forwards }
  @keyframes ripple{
    0%   { opacity:.7; transform: translate(-50%,-50%) scale(0.15) }
    70%  { opacity:.3; transform: translate(-50%,-50%) scale(15) }
    100% { opacity:0; transform: translate(-50%,-50%) scale(20) }
  }

  .pill{
    padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,0.55);
    background: linear-gradient(180deg, rgba(255,255,255,0.24), rgba(255,255,255,0.12));
    display:inline-flex; align-items:center; gap:8px; color:var(--ink-contrast);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.75);
  }
  .pill input[type="checkbox"]{ width:18px; height:18px; accent-color:#f7b0c0; }

  .hint{ font-size:12px; opacity:.9; color:#2b1a14 }

  /* Drop alanı */
  .drop{
    border:2px dashed rgba(255,255,255,0.65);
    border-radius:16px; padding:16px; text-align:center;
    background: linear-gradient(180deg, rgba(255,255,255,0.24), rgba(255,255,255,0.12));
    color:var(--ink-contrast);
    transition: border-color .25s ease, box-shadow .25s ease, transform .15s ease, background .25s ease;
  }
  .drop:hover{ box-shadow: 0 12px 30px rgba(248,168,181,0.18) }
  .drop.drag{
    background: linear-gradient(180deg, rgba(255,255,255,0.32), rgba(255,255,255,0.16));
    border-color:#fff; transform: scale(0.995);
    box-shadow: 0 14px 38px rgba(247,189,134,0.22), inset 0 0 0 1px rgba(255,255,255,0.55);
  }

  small.mono{ font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace }

  ::selection{ background: rgba(248,168,181,0.55); color:#2b1a14 }

  @media (prefers-reduced-motion: reduce){
    *{ animation-duration:.01ms !important; animation-iteration-count:1 !important; transition:none !important }
  }
</style>
</head>
<body>
  <!-- Sol üstte animasyonlu logo -->
  <div class="brand">adan.ai</div>

  <!-- Arka plan cam dokusu -->
  <div class="noise" aria-hidden="true"></div>

  <!-- MERKEZDE ULTRA LIQUID GLASS PANEL -->
  <div class="shell">
    <p class="sub">
      Backend: <code id="be">http://127.0.0.1:8899</code>
    </p>

    <div class="grid">
      <!-- Chat -->
      <div class="card">
        <div id="log"></div>

        <div class="row" style="margin-top:8px">
          <input id="q" placeholder='Type here… (e.g. "Summarize the uploaded file")'>
          <button id="send">Send</button>
        </div>

        <div class="row" style="margin-top:8px;align-items:center">
          <label class="pill"><input id="speak" type="checkbox" checked> Speak replies</label>
          <label class="pill"><input id="use11" type="checkbox"> Use ElevenLabs TTS</label>
          <span class="hint"><small class="mono">/api/chat • /api/tts • /api/extract</small></span>
        </div>
      </div>

      <!-- File extract + summarize -->
      <div class="card">
        <h3 style="margin:6px 0 6px;color:#2b1a14">Upload & Summarize</h3>
        <div id="drop" class="drop">Drop a file here (PDF/DOCX/PPTX/XLSX/CSV/TXT/MD/HTML) or click to choose.</div>
        <input id="file" type="file" accept=".pdf,.docx,.pptx,.xlsx,.xlsm,.xltx,.csv,.txt,.md,.rtf,.html,.htm" hidden />
        <div class="row" style="margin-top:8px">
          <button id="extractBtn">Extract Text</button>
          <button id="sumBtn">Summarize Extracted Text</button>
        </div>
        <textarea id="extracted" placeholder="Extracted text will appear here…"></textarea>
      </div>
    </div>
  </div>

  <!-- MP3 çalmak için -->
  <audio id="ttsAudio"></audio>

<script>
/* =========================
   ORIGINAL SCRIPT (UNCHANGED)
   ========================= */
const BACKEND = document.getElementById('be').textContent.trim();
const logEl   = document.getElementById('log');
const q       = document.getElementById('q');
const sendBtn = document.getElementById('send');
const speakToggle = document.getElementById('speak');
const use11   = document.getElementById('use11');
const audioEl = document.getElementById('ttsAudio');

function add(role, text){
  const d=document.createElement('div');
  d.className='msg '+(role==='you'?'you':'bot');
  d.textContent=(role==='you'?'You: ':'Assistant: ')+text;
  logEl.appendChild(d); logEl.scrollTop=logEl.scrollHeight;
}

function stripThink(s){
  return (s||"").replace(/<think>[\s\S]*?<\/think>/gi,"").trim();
}

async function chat(text){
  add('you', text);
  try{
    const r = await fetch(BACKEND+'/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({text})
    });
    const j = await r.json();
    const reply = stripThink((j.reply||'').trim()) || '(empty)';
    add('bot', reply);
    if (speakToggle.checked && reply) await tts(reply);
  }catch(e){
    add('bot','(error: '+e.message+')');
  }
}

sendBtn.onclick = ()=>{ const text=q.value.trim(); if(!text) return; q.value=''; chat(text); };
q.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); sendBtn.click(); }});

// ---------- TTS: ElevenLabs (backend) veya tarayıcı ----------
async function tts(text) {
  if (!speakToggle.checked || !text) return;

  // ElevenLabs seçiliyse backend'e iste gönder
  if (use11 && use11.checked) {
    try {
      const r = await fetch(BACKEND + "/api/tts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text })
      });
      if (!r.ok) {
        const t = await r.text();
        console.warn("TTS error:", t);
        return speakWithBrowserTTS(text);
      }
      const blob = await r.blob(); // audio/mpeg
      audioEl.src = URL.createObjectURL(blob);
      await audioEl.play();
      return;
    } catch (e) {
      console.warn("TTS fetch failed:", e);
      return speakWithBrowserTTS(text);
    }
  }

  // Default: tarayıcı TTS
  speakWithBrowserTTS(text);
}

function speakWithBrowserTTS(text) {
  try {
    const utter = new SpeechSynthesisUtterance(text);
    // İstersen burada dil/aksan seçebilirsin (ör: İngilizce)
    // utter.lang = 'en-US';  // Türkçe için: 'tr-TR'
    utter.rate = 1.0; utter.pitch = 1.0;
    const voices = speechSynthesis.getVoices();
    // Örnek: uygun bir İngilizce sesi yakalamaya çalış
    const v = voices.find(v=>/en[-_]/i.test(v.lang)) || voices[0];
    if (v) utter.voice = v;
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
  } catch(_) {}
}

// ---------- Upload & Extract ----------
const drop = document.getElementById('drop');
const file = document.getElementById('file');
const extracted = document.getElementById('extracted');

drop.addEventListener('click', ()=> file.click());
;['dragenter','dragover'].forEach(ev=> drop.addEventListener(ev, e=>{ e.preventDefault(); drop.classList.add('drag'); }));
;['dragleave','drop'].forEach(ev=> drop.addEventListener(ev, e=>{ e.preventDefault(); drop.classList.remove('drag'); }));
drop.addEventListener('drop', e=>{
  const f=e.dataTransfer.files?.[0];
  if(f){ file.files = e.dataTransfer.files; }
});

document.getElementById('extractBtn').onclick = async ()=>{
  if(!file.files || file.files.length===0){ alert('Select a file first.'); return; }
  const f = file.files[0];
  const fd = new FormData(); fd.append('file', f, f.name);
  extracted.value = 'Extracting…';
  try{
    const r = await fetch(BACKEND+'/api/extract', { method:'POST', body: fd });
    const j = await r.json();
    if(!j.ok) throw new Error(j.detail || 'extract failed');
    extracted.value = j.text || '';
    add('bot', 'File text extracted. You can click "Summarize Extracted Text".');
  }catch(e){
    extracted.value = '';
    add('bot', '(extract error: '+e.message+')');
  }
};

document.getElementById('sumBtn').onclick = async ()=>{
  const txt = extracted.value.trim();
  if(!txt){ alert('No extracted text.'); return; }
  const prompt =
`Summarize the following text into 6–10 concise bullet points. Keep key metrics.

TEXT:
${txt.slice(0,15000)}`;
  await chat(prompt);
};
</script>
</body>
</html>